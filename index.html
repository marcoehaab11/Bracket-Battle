<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ŸÇÿ±ÿπÿ© ÿßŸÑŸÅÿ±ŸÇ - Ÿáÿ±ŸÖŸä</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      background-color: #f7f9fc;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      background-color: #1e88e5;
      color: white;
      width: 100%;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .container {
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    textarea {
      width: 100%;
      height: 120px;
      font-size: 16px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      resize: vertical;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      margin: 10px 5px 0;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn-primary {
      background-color: #1e88e5;
      color: white;
    }
    .btn-pdf {
      background-color: #43a047;
      color: white;
    }
    .btn-word {
      background-color: #f9a825;
      color: white;
    }
    .bracket {
      margin-top: 20px;
    }
    .tree-container {
      margin-top: 40px;
      overflow-x: auto;
      padding-bottom: 40px;
    }
    .tree {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 60px;
      flex-wrap: nowrap;
      position: relative;
    }
    .column {
      display: flex;
      flex-direction: column;
      gap: 40px;
      position: relative;
    }
    .node {
      background: #e3f2fd;
      padding: 10px 20px;
      border-radius: 8px;
      text-align: center;
      min-width: 120px;
      font-weight: bold;
      position: relative;
    }
    .line {
      position: absolute;
      height: 2px;
      background: #90caf9;
      top: 50%;
      right: -30px;
      width: 30px;
    }
    .connector {
      position: absolute;
      width: 2px;
      background: #90caf9;
      right: -30px;
    }
    @media (max-width: 768px) {
      .tree {
        flex-direction: column;
        align-items: center;
        gap: 0;
      }
    }
  </style>
</head>
<body>

<header>
  <h2>ÿ®ÿ±ŸÜÿßŸÖÿ¨ ŸÇÿ±ÿπÿ© ÿßŸÑŸÅÿ±ŸÇ - ÿßŸÑÿ¥ŸÉŸÑ ÿßŸÑŸáÿ±ŸÖŸä</h2>
</header>

<div class="container">
  <!-- TextBox for the title -->
  <input type="text" id="titleInput" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿπŸÜŸàÿßŸÜ ŸáŸÜÿß...">
  
  <textarea id="teamsInput" placeholder="ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖ ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸÅŸä ÿ≥ÿ∑ÿ± ŸÖÿ≥ÿ™ŸÇŸÑ..."></textarea>
  <br>
  <button class="btn-primary" onclick="drawBracket()">üéØ ÿßÿπŸÖŸÑ ÿßŸÑŸÇÿ±ÿπÿ©</button>
  <button class="btn-pdf" onclick="printToPDF()">üñ®Ô∏è ÿßÿ∑ÿ®ÿπ PDF</button>
  <button class="btn-word" onclick="printToWord()">üñ®Ô∏è ÿßÿ∑ÿ®ÿπ Word</button>

  <div class="bracket" id="bracket"></div>
  <div class="tree-container">
    <div class="tree" id="tree"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Include PizZip and docxtemplater -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.0.6/pizzip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.20.2/docxtemplater.min.js"></script>

<script>
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function drawBracket() {
  const input = document.getElementById("teamsInput").value.trim();
  let teams = input.split('\n').map(t => t.trim()).filter(t => t);
  const bracketDiv = document.getElementById("bracket");
  const treeDiv = document.getElementById("tree");
  const title = document.getElementById("titleInput").value.trim();  // Get title input
  bracketDiv.innerHTML = '';
  treeDiv.innerHTML = '';

  if (teams.length < 2) {
    bracketDiv.innerText = 'ÿßÿØÿÆŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÅÿ±ŸäŸÇŸäŸÜ.';
    return;
  }

  let nextPowerOf2 = 1;
  while (nextPowerOf2 < teams.length) nextPowerOf2 *= 2;
  while (teams.length < nextPowerOf2) {
    teams.push("BYE");
  }

  shuffle(teams);

  let round = 1;
  let currentTeams = teams;
  let rounds = [];

  // Add title to the bracket
  if (title) {
    const titleDiv = document.createElement("h3");
    titleDiv.innerText = title;
    bracketDiv.appendChild(titleDiv);
  }

  // Add participating teams
  const participatingTeams = document.createElement("h4");
  participatingTeams.innerText = `ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©: ${teams.join(', ')}`;
  bracketDiv.appendChild(participatingTeams);

  while (currentTeams.length >= 1) {
    const roundDiv = document.createElement("div");
    roundDiv.className = "round";
    roundDiv.innerHTML = `<h3>ÿßŸÑÿØŸàÿ± ${round}</h3>`;

    let thisRound = [];

    for (let i = 0; i < currentTeams.length; i += 2) {
      const team1 = currentTeams[i];
      const team2 = currentTeams[i + 1];
      const match = document.createElement("div");
      match.className = "match";
      match.innerText = `üîπ ${team1} √ó ${team2}`;
      roundDiv.appendChild(match);

      if (team1 === "BYE") {
        thisRound.push(team2);
      } else if (team2 === "BYE") {
        thisRound.push(team1);
      } else {
        thisRound.push(`ÿßŸÑŸÅÿßÿ¶ÿ≤ ŸÖŸÜ (${team1} √ó ${team2})`);
      }
    }

    bracketDiv.appendChild(roundDiv);
    rounds.push(currentTeams);

    if (thisRound.length === 1) {
      const champ = document.createElement("h2");
      champ.innerText = `üèÜ ÿßŸÑÿ®ÿ∑ŸÑ: ${thisRound[0]}`;
      bracketDiv.appendChild(champ);
      rounds.push([thisRound[0]]);
      break;
    }

    currentTeams = thisRound;
    round++;
  }

  // Generate Tree View
  for (let i = 0; i < rounds.length; i++) {
    const column = document.createElement("div");
    column.className = "column";
    rounds[i].forEach(name => {
      const node = document.createElement("div");
      node.className = "node";
      node.innerText = name;
      if (i < rounds.length - 1) {
        const line = document.createElement("div");
        line.className = "line";
        node.appendChild(line);
      }
      column.appendChild(node);
    });
    treeDiv.appendChild(column);
  }
}

// PDF Printing function
function printToPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const content = document.getElementById("bracket").innerText;
  doc.text(content, 10, 10);
  doc.save('bracket.pdf');
}

// Word Printing function
function printToWord() {
  const title = document.getElementById("titleInput").value.trim();
  const teams = document.getElementById("teamsInput").value.trim().split('\n').map(t => t.trim()).filter(t => t);
  const content = `
    <h3>ÿßŸÑÿπŸÜŸàÿßŸÜ: ${title}</h3>
    <h4>ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©: ${teams.join(', ')}</h4>
    ${document.getElementById("bracket").innerHTML}
  `;
  
  const zip = new PizZip();
  const doc = new docxtemplater(zip);
  const docxContent = doc.createContent();
  
  // Saving DOCX
  const blob = docxContent.createBlob();
  saveAs(blob, "bracket.docx");
}
</script>

</body>
</html>
